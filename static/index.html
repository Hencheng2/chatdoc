<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Personal AI</title>
  <style>
    body {
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      background-color: #0d1b0d;
      color: #eee;
      display: flex; flex-direction: column;
      height: 100vh;
    }
    header {
      background: #123d12;
      padding: 1rem; text-align: center;
      color: #ff8800; font-size: 1.5rem;
    }
    #chat-container {
      flex: 1; overflow-y: auto; padding: 1rem;
    }
    .msg { margin: 0.5rem 0; }
    .user { color: #ff8800; }
    .bot { color: #8aff8a; }
    #input-area {
      display: flex; padding: 0.5rem;
      background: #123d12;
    }
    #message { flex: 1; padding: 0.5rem; }
    button {
      padding: 0.5rem 1rem; margin-left: 0.5rem;
      background: #ff8800; border: none;
      color: #fff; cursor: pointer; border-radius: 5px;
    }
    #admin {
      padding: 1rem; background: #1a2e1a;
      border-top: 1px solid #333;
    }
    input, textarea {
      width: 100%; padding: 0.5rem; margin: 0.5rem 0;
      background: #0d1b0d; color: #eee; border: 1px solid #444;
    }
    #docs-list {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #ccc;
    }
  </style>
</head>
<body>
  <header>ü§ñ My Personal AI Chatbot</header>
  <div id="chat-container"></div>
  <div id="input-area">
    <input id="message" type="text" placeholder="Ask me anything...">
    <button onclick="sendMessage()">Send</button>
  </div>
  <div id="admin">
    <h3 style="color:#ff8800;">Admin Panel</h3>
    <input id="password" type="password" placeholder="Password">
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload File</button>
    <textarea id="manualText" placeholder="Add knowledge manually"></textarea>
    <input id="manualTitle" type="text" placeholder="Title (optional)">
    <button onclick="addText()">Save Text</button>
    <div id="docs-list"></div>
  </div>
<script>
function appendMessage(sender, text, cls) {
  const chat = document.getElementById("chat-container");
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerHTML = `<b>${sender}:</b> ${text}`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMessage() {
  const msg = document.getElementById("message").value.trim();
  if (!msg) return;
  appendMessage("You", msg, "user");
  document.getElementById("message").value = "";
  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({message: msg})
    });
    const data = await res.json();
    if (data.response) appendMessage("Bot", data.response, "bot");
    else if (data.error) appendMessage("Bot", "‚ö†Ô∏è Error: " + data.error, "bot");
  } catch (err) {
    appendMessage("Bot", "‚ö†Ô∏è Network error: " + err.message, "bot");
  }
}

async function uploadFile() {
  const file = document.getElementById("fileInput").files[0];
  const password = document.getElementById("password").value;
  if (!file || !password) { alert("File and password required"); return; }
  const form = new FormData();
  form.append("file", file);
  form.append("password", password);
  const res = await fetch("/api/upload", {method: "POST", body: form});
  const data = await res.json();
  alert(data.success ? "Uploaded!" : "Error: " + (data.error || "unknown"));
  loadDocs();
}

async function addText() {
  const text = document.getElementById("manualText").value.trim();
  const title = document.getElementById("manualTitle").value.trim();
  const password = document.getElementById("password").value;
  if (!text || !password) { alert("Text and password required"); return; }
  const res = await fetch("/api/add_text", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({content: text, title: title, password: password})
  });
  const data = await res.json();
  alert(data.success ? "Text saved!" : "Error: " + (data.error || "unknown"));
  loadDocs();
}

async function loadDocs() {
  const res = await fetch("/api/docs");
  const docs = await res.json();
  const div = document.getElementById("docs-list");
  div.innerHTML = "<b>üìÇ Knowledge Base:</b><br>" + docs.map(d => `- ${d.title} (${d.filename || "manual"})`).join("<br>");
}
loadDocs();
</script>
</body>
</html>
